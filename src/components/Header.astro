---
import { Image } from 'astro:assets';
import type {ImageMetadata} from "astro";
import Navbar from "./Navbar.astro";
import navigation from '../settings/navigation.json'
import settings from '../settings/site-settings.json'

const currentPath = Astro.url.pathname;
const images = import.meta.glob<{ default: ImageMetadata }>('/src/assets/images/*.{jpeg,jpg,png,gif,webp}')
if (!images[settings.logo])
    throw new Error(`"${settings.logo}" does not exist in: "src/assets/images*.{jpeg,jpg,png,gif,webp}"`);
const logoAlt = 'Logo Heilpraktikerin Simone Schulz';

// Find the current navigation item to get the header image
const currentLink = navigation.links
    .flatMap(l => [l, ...(l.sublinks)])
    .find(l => {
        return l.href === currentPath
    });

const headerImage = currentLink?.header || '/src/assets/images/Header_Startseite.jpg';

// Breadcrumb logic
let breadcrumbs = [];
for (const link of navigation.links) {
    if (link.href === currentPath) {
        breadcrumbs.push({label: link.label, href: link.href});
        break;
    }
    if (link.sublinks) {
        const sublink = link.sublinks.find(s => s.href === currentPath);
        if (sublink) {
            breadcrumbs.push({label: link.label, href: link.href});
            breadcrumbs.push({label: sublink.label, href: sublink.href});
            break;
        }
    }
}
---
<header id="header">
  <div class="inside">
    <div class="innerwrapper">
      <div class="logo">
        <div>
          <a href="/" title="Startseite">
            <Image src={images[settings.logo]()} alt={logoAlt} title={logoAlt} height={120} quality="high" densities={[1.5, 2]}/>
          </a>
        </div>
      </div>
      <div class="right-elements">
      </div>
    </div>
    <div class="mod_article headerimage block" id="article-124">
      <div class="ce_gallery block">
        <ul>
          <li class="row_0 row_first row_last even col_0 col_first col_last"
              style={`background-image:url(${headerImage});`}>
          </li>
        </ul>
      </div>
    </div>
    <div class="placeholder"></div>
    <div class="nav-wrapper">
      <Navbar/>
      <div class="show-mobile">
      </div>
    </div>
    <nav class="mod_breadcrumb block" aria-label="Breadcrumb">
      <ul>
        <li class="first">
          <a href="/" title="Heilpraktikerin Simone Schulz - Frankfurt">Heilpraktikerin Simone Schulz Frankfurt</a>
        </li>
        {breadcrumbs.map((crumb, index) => (
          <li class={index === breadcrumbs.length - 1 ? "active last" : ""} aria-current={index === breadcrumbs.length - 1 ? "page" : undefined}>
            {index === breadcrumbs.length - 1 ? (
              crumb.label
            ) : (
              <a href={crumb.href} title={crumb.label}>{crumb.label}</a>
            )}
          </li>
        ))}
      </ul>
    </nav>
  </div>
</header>